!function(d,a,t){a.wp=a.wp||{},a.wp.gdbbx=a.wp.gdbbx||{},a.wp.gdbbx.meta={storage:{action:"",nonce:"",post:"",id:""},init:function(){wp.gdbbx.meta.media.init(),wp.gdbbx.meta.dialogs.metabox(),d(t).on("click",".gdbbx-edit-attachment-attach",function(t){t.preventDefault(),wp.gdbbx.meta.storage.nonce=d(this).data("nonce"),wp.gdbbx.meta.storage.post=d(this).data("post"),wp.gdbbx.meta.media.open(a.wp.gdbbx.meta.attach,!0)}),d(t).on("click",".gdbbx-edit-attachment-delete",function(t){t.preventDefault(),wp.gdbbx.meta.storage.action="delete",wp.gdbbx.meta.storage.nonce=d(this).data("nonce"),wp.gdbbx.meta.storage.post=d(this).data("post"),wp.gdbbx.meta.storage.id=d(this).data("id"),d("#gdbbx-dialog-attachment-delete").wpdialog("open")}),d(t).on("click",".gdbbx-edit-attachment-detach",function(t){t.preventDefault(),wp.gdbbx.meta.storage.action="detach",wp.gdbbx.meta.storage.nonce=d(this).data("nonce"),wp.gdbbx.meta.storage.post=d(this).data("post"),wp.gdbbx.meta.storage.id=d(this).data("id"),d("#gdbbx-dialog-attachment-detach").wpdialog("open")}),d(".d4plib-metabox-wrapper .gdbbx-override").change(function(){var t=d(this).val(),a=d(this).parent().next();"yes"===t?a.slideDown():a.slideUp()})},media:{handler:null,init:function(){wp&&wp.media&&void 0===wp.media.frames.gdbbx_attachment_frame&&(wp.media.frames.gdbbx_attachment_frame=wp.media({title:gdbbx_meta_data.string_media_dialog_title,className:"media-frame gdbbx-attachment-frame",frame:"post",multiple:!0,button:{text:gdbbx_meta_data.string_media_dialog_button}}),wp.media.frames.gdbbx_attachment_frame.on("insert",function(){var t=wp.media.frames.gdbbx_attachment_frame.state().get("selection").toJSON();wp.gdbbx.meta.media.handler&&wp.gdbbx.meta.media.handler(t)}))},open:function(t,a){wp.gdbbx.meta.media.handler=t,wp.media.frames.gdbbx_attachment_frame.open(),d(".gdbbx-attachment-frame .media-frame-title h1").html(gdbbx_meta_data.string_media_dialog_title),d(".gdbbx-attachment-frame .media-frame-toolbar .media-toolbar-primary .media-button-insert").html(gdbbx_meta_data.string_media_dialog_button),a&&d(".gdbbx-attachment-frame").addClass("hide-menu")}},attach:function(t){for(var a={nonce:wp.gdbbx.meta.storage.nonce,post:wp.gdbbx.meta.storage.post,id:[]},e=0;e<t.length;e++)a.id.push(t[e].id);d("#gdbbx-meta-files ul").append("<li class='please-wait'>"+gdbbx_meta_data.dialog_content_pleasewait+"</li>"),d.ajax({dataType:"html",type:"post",data:a,url:ajaxurl+"?action=gdbbx_attachment_attach",success:function(t){d("#gdbbx-meta-files .please-wait").replaceWith(t)}})},do:function(){var a=d(".gdbbx-attachment-id-"+wp.gdbbx.meta.storage.id),t={nonce:wp.gdbbx.meta.storage.nonce,post:wp.gdbbx.meta.storage.post,id:wp.gdbbx.meta.storage.id};d("span",a).hide(),a.append("<strong>"+gdbbx_meta_data.dialog_content_pleasewait+"</strong>"),d.ajax({dataType:"json",type:"post",data:t,url:ajaxurl+"?action=gdbbx_attachment_"+wp.gdbbx.meta.storage.action,success:function(t){"ok"===t.status?a.fadeOut("slow",function(){d(this).remove()}):d("strong",a).html(gdbbx_meta_data.dialog_content_failed)}})},dialogs:{classes:function(t){var a="wp-dialog d4p-dialog gdbbx-modal-dialog";return""!==t&&(a+=" "+t),a},defaults:function(){return{width:480,height:"auto",minHeight:24,autoOpen:!1,resizable:!1,modal:!0,closeOnEscape:!1,zIndex:3e5,open:function(){d(".gdbbx-button-focus").focus()}}},icons:function(t){d(t).next().find(".ui-dialog-buttonset button").each(function(){var t=d(this).data("icon");""!==t&&d(this).find("span.ui-button-text").prepend(gdbbx_meta_data["button_icon_"+t])})},metabox:function(){var t=d.extend({},wp.gdbbx.meta.dialogs.defaults(),{dialogClass:wp.gdbbx.meta.dialogs.classes("gdbbx-dialog-hidex"),buttons:[{id:"gdbbx-delete-del-delete",class:"gdbbx-dialog-button-delete",text:gdbbx_meta_data.dialog_button_delete,data:{icon:"delete"},click:function(){d("#gdbbx-dialog-attachment-delete").wpdialog("close"),wp.gdbbx.meta.do()}},{id:"gdbbx-delete-del-cancel",class:"gdbbx-dialog-button-cancel gdbbx-button-focus",text:gdbbx_meta_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){d("#gdbbx-dialog-attachment-delete").wpdialog("close")}}]}),a=d.extend({},wp.gdbbx.meta.dialogs.defaults(),{dialogClass:wp.gdbbx.meta.dialogs.classes("gdbbx-dialog-hidex"),buttons:[{id:"gdbbx-delete-del-detach",class:"gdbbx-dialog-button-detach",text:gdbbx_meta_data.dialog_button_detach,data:{icon:"detach"},click:function(){d("#gdbbx-dialog-attachment-detach").wpdialog("close"),wp.gdbbx.meta.do()}},{id:"gdbbx-delete-del-cancel",class:"gdbbx-dialog-button-cancel gdbbx-button-focus",text:gdbbx_meta_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){d("#gdbbx-dialog-attachment-detach").wpdialog("close")}}]});d("#gdbbx-dialog-attachment-delete").wpdialog(t),d("#gdbbx-dialog-attachment-detach").wpdialog(a),wp.gdbbx.meta.dialogs.icons("#gdbbx-dialog-attachment-delete"),wp.gdbbx.meta.dialogs.icons("#gdbbx-dialog-attachment-detach")}}},wp.gdbbx.meta.init()}(jQuery,window,document);