!function(d,a,t){a.wp=a.wp||{},a.wp.bbpc=a.wp.bbpc||{},a.wp.bbpc.meta={storage:{action:"",nonce:"",post:"",id:""},init:function(){wp.bbpc.meta.media.init(),wp.bbpc.meta.dialogs.metabox(),d(t).on("click",".bbpc-edit-attachment-attach",function(t){t.preventDefault(),wp.bbpc.meta.storage.nonce=d(this).data("nonce"),wp.bbpc.meta.storage.post=d(this).data("post"),wp.bbpc.meta.media.open(a.wp.bbpc.meta.attach,!0)}),d(t).on("click",".bbpc-edit-attachment-delete",function(t){t.preventDefault(),wp.bbpc.meta.storage.action="delete",wp.bbpc.meta.storage.nonce=d(this).data("nonce"),wp.bbpc.meta.storage.post=d(this).data("post"),wp.bbpc.meta.storage.id=d(this).data("id"),d("#bbpc-dialog-attachment-delete").wpdialog("open")}),d(t).on("click",".bbpc-edit-attachment-detach",function(t){t.preventDefault(),wp.bbpc.meta.storage.action="detach",wp.bbpc.meta.storage.nonce=d(this).data("nonce"),wp.bbpc.meta.storage.post=d(this).data("post"),wp.bbpc.meta.storage.id=d(this).data("id"),d("#bbpc-dialog-attachment-detach").wpdialog("open")}),d(".d4plib-metabox-wrapper .bbpc-override").change(function(){var t=d(this).val(),a=d(this).parent().next();"yes"===t?a.slideDown():a.slideUp()})},media:{handler:null,init:function(){wp&&wp.media&&void 0===wp.media.frames.bbpc_attachment_frame&&(wp.media.frames.bbpc_attachment_frame=wp.media({title:bbpc_meta_data.string_media_dialog_title,className:"media-frame bbpc-attachment-frame",frame:"post",multiple:!0,button:{text:bbpc_meta_data.string_media_dialog_button}}),wp.media.frames.bbpc_attachment_frame.on("insert",function(){var t=wp.media.frames.bbpc_attachment_frame.state().get("selection").toJSON();wp.bbpc.meta.media.handler&&wp.bbpc.meta.media.handler(t)}))},open:function(t,a){wp.bbpc.meta.media.handler=t,wp.media.frames.bbpc_attachment_frame.open(),d(".bbpc-attachment-frame .media-frame-title h1").html(bbpc_meta_data.string_media_dialog_title),d(".bbpc-attachment-frame .media-frame-toolbar .media-toolbar-primary .media-button-insert").html(bbpc_meta_data.string_media_dialog_button),a&&d(".bbpc-attachment-frame").addClass("hide-menu")}},attach:function(t){for(var a={nonce:wp.bbpc.meta.storage.nonce,post:wp.bbpc.meta.storage.post,id:[]},e=0;e<t.length;e++)a.id.push(t[e].id);d("#bbpc-meta-files ul").append("<li class='please-wait'>"+bbpc_meta_data.dialog_content_pleasewait+"</li>"),d.ajax({dataType:"html",type:"post",data:a,url:ajaxurl+"?action=bbpc_attachment_attach",success:function(t){d("#bbpc-meta-files .please-wait").replaceWith(t)}})},do:function(){var a=d(".bbpc-attachment-id-"+wp.bbpc.meta.storage.id),t={nonce:wp.bbpc.meta.storage.nonce,post:wp.bbpc.meta.storage.post,id:wp.bbpc.meta.storage.id};d("span",a).hide(),a.append("<strong>"+bbpc_meta_data.dialog_content_pleasewait+"</strong>"),d.ajax({dataType:"json",type:"post",data:t,url:ajaxurl+"?action=bbpc_attachment_"+wp.bbpc.meta.storage.action,success:function(t){"ok"===t.status?a.fadeOut("slow",function(){d(this).remove()}):d("strong",a).html(bbpc_meta_data.dialog_content_failed)}})},dialogs:{classes:function(t){var a="wp-dialog d4p-dialog bbpc-modal-dialog";return""!==t&&(a+=" "+t),a},defaults:function(){return{width:480,height:"auto",minHeight:24,autoOpen:!1,resizable:!1,modal:!0,closeOnEscape:!1,zIndex:3e5,open:function(){d(".bbpc-button-focus").focus()}}},icons:function(t){d(t).next().find(".ui-dialog-buttonset button").each(function(){var t=d(this).data("icon");""!==t&&d(this).find("span.ui-button-text").prepend(bbpc_meta_data["button_icon_"+t])})},metabox:function(){var t=d.extend({},wp.bbpc.meta.dialogs.defaults(),{dialogClass:wp.bbpc.meta.dialogs.classes("bbpc-dialog-hidex"),buttons:[{id:"bbpc-delete-del-delete",class:"bbpc-dialog-button-delete",text:bbpc_meta_data.dialog_button_delete,data:{icon:"delete"},click:function(){d("#bbpc-dialog-attachment-delete").wpdialog("close"),wp.bbpc.meta.do()}},{id:"bbpc-delete-del-cancel",class:"bbpc-dialog-button-cancel bbpc-button-focus",text:bbpc_meta_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){d("#bbpc-dialog-attachment-delete").wpdialog("close")}}]}),a=d.extend({},wp.bbpc.meta.dialogs.defaults(),{dialogClass:wp.bbpc.meta.dialogs.classes("bbpc-dialog-hidex"),buttons:[{id:"bbpc-delete-del-detach",class:"bbpc-dialog-button-detach",text:bbpc_meta_data.dialog_button_detach,data:{icon:"detach"},click:function(){d("#bbpc-dialog-attachment-detach").wpdialog("close"),wp.bbpc.meta.do()}},{id:"bbpc-delete-del-cancel",class:"bbpc-dialog-button-cancel bbpc-button-focus",text:bbpc_meta_data.dialog_button_cancel,data:{icon:"cancel"},click:function(){d("#bbpc-dialog-attachment-detach").wpdialog("close")}}]});d("#bbpc-dialog-attachment-delete").wpdialog(t),d("#bbpc-dialog-attachment-detach").wpdialog(a),wp.bbpc.meta.dialogs.icons("#bbpc-dialog-attachment-delete"),wp.bbpc.meta.dialogs.icons("#bbpc-dialog-attachment-detach")}}},wp.bbpc.meta.init()}(jQuery,window,document);