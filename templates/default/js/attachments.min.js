!function(o,l,t){l.wp=l.wp||{},l.wp.gdbbx=l.wp.gdbbx||{},l.wp.gdbbx.attachments={is_enhanced:!0,allow_submit:!0,extensions:[],files:[],inner:1,init:function(){o("form#new-post").attr("enctype","multipart/form-data"),this.is_enhanced="enhanced"===gdbbx_data.attachments.method&&9<wp.gdbbx.helper.detect_msie(),"string"==typeof gdbbx_data.attachments.allowed_extensions&&(this.extensions=gdbbx_data.attachments.allowed_extensions.split(" ")),this.actions(),(this.is_enhanced?this.enhanced:this.basic).run(),this.thread.run()},actions:function(){o(t).on("click",".gdbbx-attachment-insert",function(t){t.preventDefault();t=o(this).attr("href").substr(1);wp.gdbbx.helper.into_editor('[attachment file="'+t+'"]'),wp.gdbbx.helper.scroll_to_editor()}),o(t).on("click",".gdbbx-attachment-confirm",function(t){confirm(gdbbx_data.text.are_you_sure)||t.preventDefault()}),o(t).on("click",".gdbbx-attachment-add-file",function(t){t.preventDefault(),wp.gdbbx.attachments.add(this)})},count:function(){return o(".gdbbx-attachments-input").length},count_empty:function(){return o(".gdbbx-attachments-input:not(.gdbbx-attachment-added)").length},add:function(t){(!gdbbx_data.attachments.limiter||wp.gdbbx.attachments.count()<gdbbx_data.attachments.max_files)&&(!gdbbx_data.attachments.auto_new_file||gdbbx_data.attachments.auto_new_file&&0===wp.gdbbx.attachments.count_empty())&&(wp.gdbbx.attachments.is_enhanced?o(t).before(wp.gdbbx.attachments.enhanced.block()):o(t).before(wp.gdbbx.attachments.basic.block())),!gdbbx_data.attachments.auto_new_file&&gdbbx_data.attachments.limiter&&wp.gdbbx.attachments.count()===gdbbx_data.attachments.max_files&&o(t).hide()},enhanced:{run:function(){o(".gdbbx-attachments-form > div").addClass("gdbbx-validation-active"),gdbbx_data.attachments.auto_new_file&&o(".gdbbx-attachments-form").addClass("gdbbx-auto-newfile"),wp.gdbbx.attachments.enhanced.actions()},actions:function(){o(t).on("click",".gdbbx-attachment-preview",function(){o(this).closest(".gdbbx-attachments-input").find("input[type=file]").click()}),o(t).on("click",".gdbbx-attachments-input a.bbp-att-remove",function(t){t.preventDefault();var a=o(this).closest(".gdbbx-attachments-input"),t=a.data("id");delete wp.gdbbx.attachments.files[t],a.fadeOut("slow",function(){var t;gdbbx_data.attachments.auto_new_file?(t=a.parent(),0===o(".gdbbx-attachments-input:not(.gdbbx-attachment-added)",t).length&&o(".gdbbx-attachment-add-file",t).before(wp.gdbbx.attachments.enhanced.block())):o(".gdbbx-attachment-add-file").show(),0===wp.gdbbx.attachments.count()&&o(this).after(wp.gdbbx.attachments.enhanced.block()),o(this).remove(),wp.gdbbx.attachments.enhanced.check_submit()})}),o(t).on("change",".gdbbx-attachments-input input[type=file]",wp.gdbbx.attachments.enhanced.attach),o(t).on("click",".gdbbx-attachments-input a.bbp-att-caption",function(t){t.preventDefault(),o(this).prev().find("input").show(),o(this).hide()}),o(t).on("click",".gdbbx-attachments-input a.bbp-att-shortcode",function(t){t.preventDefault();t='[attachment file="'+o(this).data("file")+'"]';wp.gdbbx.helper.into_editor(t),wp.gdbbx.helper.scroll_to_editor()})},attach:function(){var t,a,e,n,d,b,s,c,i,h,r;this.files&&1===this.files.length&&(t=o(this).closest(".gdbbx-attachments-input"),b=d=n=e=!(a=""),r="",s=this.files[0],c=Math.round(s.size/1024),i=wp.gdbbx.helper.file_extension(s.name),h=s.name+s.size+s.lastModified+s.type,t.removeClass("gdbbx-attachment-invalid").addClass("gdbbx-attachment-added").data("id",wp.gdbbx.attachments.inner),r="<div>"+gdbbx_data.attachments.text.file_name+": <strong>"+s.name+"</strong></div>",r+="<div>"+gdbbx_data.attachments.text.file_size+": <strong>"+c+" kb</strong>, ",r+=gdbbx_data.attachments.text.file_type+": <strong>"+i.toUpperCase()+"</strong></div>",-1<o.inArray(i,["js","php"])&&(b=e=!1),o.each(wp.gdbbx.attachments.files,function(t,a){if(a===h)return n=e=!1}),n&&(wp.gdbbx.attachments.files[wp.gdbbx.attachments.inner]=h),gdbbx_data.attachments.limiter&&(s.size>gdbbx_data.attachments.max_size&&(d=e=!1),0<wp.gdbbx.attachments.extensions.length&&-1===o.inArray(i,wp.gdbbx.attachments.extensions)&&(b=e=!1)),e||(r+="<strong>",r+=gdbbx_data.attachments.text.file_validation,n||(r+=" "+gdbbx_data.attachments.text.file_validation_duplicate),b||(r+=" "+gdbbx_data.attachments.text.file_validation_type),d||(r+=" "+gdbbx_data.attachments.text.file_validation_size),r+="</strong><br/>",t.addClass("gdbbx-attachment-invalid")),e&&(gdbbx_data.attachments.set_caption_file&&(r+="<div><label><input name='gdbbx-attachment_caption[]' type='text' style='display: none' placeholder='"+gdbbx_data.attachments.text.file_caption_placeholder+"' /><span class='gdbbx-accessibility-show-for-sr'>"+gdbbx_data.attachments.text.file_caption_placeholder+"</span></label><a data-file='"+s.name+"' class='bbp-att-caption' href='#'>"+gdbbx_data.attachments.text.file_caption+"</a></div>"),gdbbx_data.attachments.insert_into_content&&(r+="<div><a class='bbp-att-shortcode' href='#'>"+gdbbx_data.attachments.text.file_shortcode+"</a></div>")),r+="<div><a class='bbp-att-remove' href='#'>"+gdbbx_data.attachments.text.file_remove+"</a></div>",t.find(".gdbbx-attachment-control").html(r),t.find(".gdbbx-attachment-control .bbp-att-shortcode").data("file",s.name),t.find(".gdbbx-attachment-preview .gdbbx-attached-file").remove(),l.FileReader&&/^([a-zA-Z0-9\s_\\.\-:\+])+(.jpg|.jpeg|.gif|.png|.bmp)$/.test(s.name.toLowerCase())?((r=new FileReader).readAsDataURL(s),r.onloadend=function(){a='<img class="gdbbx-attached-file" alt="'+s.name+'" src="'+this.result+'" />',t.find(".gdbbx-attachment-preview").prepend(a)}):(a='<p class="gdbbx-attached-file" title="'+s.name+'">.'+i.toUpperCase()+"</p>",t.find(".gdbbx-attachment-preview").prepend(a)),wp.gdbbx.attachments.inner++,wp.gdbbx.attachments.add(".gdbbx-attachments-form .gdbbx-attachment-add-file"),wp.gdbbx.attachments.enhanced.check_submit())},check_submit:function(){var t=!0;o(".gdbbx-attachments-form .gdbbx-attachments-input").each(function(){o(this).hasClass("gdbbx-attachment-invalid")&&(t=!1)}),o(".gdbbx-attachments-form").closest("form").find(".bbp-submit-wrapper button").attr("disabled",!t)},block:function(){var t='<div class="gdbbx-attachments-input gdbbx-validation-active">';return t+='<div role="button" class="gdbbx-attachment-preview"><span aria-hidden="true">'+gdbbx_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="gdbbx-attachment[]" />',t+='<span class="gdbbx-accessibility-show-for-sr">'+gdbbx_data.attachments.text.select_file+"</span></label>",t+='<div class="gdbbx-attachment-control"></div>',t+="</div>"}},basic:{run:function(){},actions:function(){},block:function(){var t='<div class="gdbbx-attachments-input gdbbx-validation-disabled">';return t+='<div class="gdbbx-attachment-header"><span aria-hidden="true">'+gdbbx_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="gdbbx-attachment[]" />',t+='<span class="gdbbx-accessibility-show-for-sr">'+gdbbx_data.attachments.text.select_file+"</span></label>",t+="</div>"}},thread:{nonce:"",topic:0,current:1,run:function(){o(t).on("click",".gdbbx-attachments-thread-pager .__prev",function(t){t.preventDefault();t=o(this).closest(".bbp-form");1<wp.gdbbx.attachments.thread.current&&(wp.gdbbx.attachments.thread.current--,wp.gdbbx.attachments.thread.show(t))}),o(t).on("click",".gdbbx-attachments-thread-pager .__next",function(t){t.preventDefault();var a=o(this).closest(".bbp-form"),t=o(".gdbbx-attachments-thread-pages",a).data("pages");wp.gdbbx.attachments.thread.current<t&&(wp.gdbbx.attachments.thread.current++,wp.gdbbx.attachments.thread.show(a))}),o(t).on("click",".gdbbx-attachments-thread-control a",function(t){t.preventDefault();t=o(this).parent().parent().find(".bbp-form");wp.gdbbx.attachments.thread.nonce=o(this).data("nonce"),wp.gdbbx.attachments.thread.topic=o(this).data("topic"),o(this).parent().remove(),t.show(),wp.gdbbx.attachments.thread.fetch(t,1)})},show:function(t){var a=o(".gdbbx-attachments-thread-pages",t),e=o(".gdbbx-attachments-thread-pager",t),n=a.data("pages"),d=wp.gdbbx.attachments.thread.current,a=o(".gdbbx-attachments-thread-page-"+wp.gdbbx.attachments.thread.current,t);e.removeClass("gdbbx-thread-current-first").removeClass("gdbbx-thread-current-last"),1===d?e.addClass("gdbbx-thread-current-first"):d===n&&e.addClass("gdbbx-thread-current-last"),o(".__current",e).html(d),a.hasClass("gdbbx-attachments-thread-empty")?wp.gdbbx.attachments.thread.fetch(t,d):(o(".gdbbx-attachments-thread-page",t).hide(),o(".gdbbx-attachments-thread-page-"+d,t).show())},fetch:function(a,e){o.ajax({dataType:"html",type:"post",data:{nonce:wp.gdbbx.attachments.thread.nonce,topic:wp.gdbbx.attachments.thread.topic,page:e},url:gdbbx_data.url+"?action=gdbbx_attachments_thread",success:function(t){o(".gdbbx-attachments-thread-page",a).hide(),o(".gdbbx-attachments-thread-page-"+e,a).html(t).removeClass("gdbbx-attachments-thread-empty").show(),o(".gdbbx-attachments-thread-pager",a).show()}})}}},o(t).ready(function(){wp.gdbbx.attachments.init()})}(jQuery,window,document);