!function(o,l,t){l.wp=l.wp||{},l.wp.bbpc=l.wp.bbpc||{},l.wp.bbpc.attachments={is_enhanced:!0,allow_submit:!0,extensions:[],files:[],inner:1,init:function(){o("form#new-post").attr("enctype","multipart/form-data"),this.is_enhanced="enhanced"===bbpc_data.attachments.method&&9<wp.bbpc.helper.detect_msie(),"string"==typeof bbpc_data.attachments.allowed_extensions&&(this.extensions=bbpc_data.attachments.allowed_extensions.split(" ")),this.actions(),(this.is_enhanced?this.enhanced:this.basic).run(),this.thread.run()},actions:function(){o(t).on("click",".bbpc-attachment-insert",function(t){t.preventDefault();t=o(this).attr("href").substr(1);wp.bbpc.helper.into_editor('[attachment file="'+t+'"]'),wp.bbpc.helper.scroll_to_editor()}),o(t).on("click",".bbpc-attachment-confirm",function(t){confirm(bbpc_data.text.are_you_sure)||t.preventDefault()}),o(t).on("click",".bbpc-attachment-add-file",function(t){t.preventDefault(),wp.bbpc.attachments.add(this)})},count:function(){return o(".bbpc-attachments-input").length},count_empty:function(){return o(".bbpc-attachments-input:not(.bbpc-attachment-added)").length},add:function(t){(!bbpc_data.attachments.limiter||wp.bbpc.attachments.count()<bbpc_data.attachments.max_files)&&(!bbpc_data.attachments.auto_new_file||bbpc_data.attachments.auto_new_file&&0===wp.bbpc.attachments.count_empty())&&(wp.bbpc.attachments.is_enhanced?o(t).before(wp.bbpc.attachments.enhanced.block()):o(t).before(wp.bbpc.attachments.basic.block())),!bbpc_data.attachments.auto_new_file&&bbpc_data.attachments.limiter&&wp.bbpc.attachments.count()===bbpc_data.attachments.max_files&&o(t).hide()},enhanced:{run:function(){o(".bbpc-attachments-form > div").addClass("bbpc-validation-active"),bbpc_data.attachments.auto_new_file&&o(".bbpc-attachments-form").addClass("bbpc-auto-newfile"),wp.bbpc.attachments.enhanced.actions()},actions:function(){o(t).on("click",".bbpc-attachment-preview",function(){o(this).closest(".bbpc-attachments-input").find("input[type=file]").click()}),o(t).on("click",".bbpc-attachments-input a.bbp-att-remove",function(t){t.preventDefault();var a=o(this).closest(".bbpc-attachments-input"),t=a.data("id");delete wp.bbpc.attachments.files[t],a.fadeOut("slow",function(){var t;bbpc_data.attachments.auto_new_file?(t=a.parent(),0===o(".bbpc-attachments-input:not(.bbpc-attachment-added)",t).length&&o(".bbpc-attachment-add-file",t).before(wp.bbpc.attachments.enhanced.block())):o(".bbpc-attachment-add-file").show(),0===wp.bbpc.attachments.count()&&o(this).after(wp.bbpc.attachments.enhanced.block()),o(this).remove(),wp.bbpc.attachments.enhanced.check_submit()})}),o(t).on("change",".bbpc-attachments-input input[type=file]",wp.bbpc.attachments.enhanced.attach),o(t).on("click",".bbpc-attachments-input a.bbp-att-caption",function(t){t.preventDefault(),o(this).prev().find("input").show(),o(this).hide()}),o(t).on("click",".bbpc-attachments-input a.bbp-att-shortcode",function(t){t.preventDefault();t='[attachment file="'+o(this).data("file")+'"]';wp.bbpc.helper.into_editor(t),wp.bbpc.helper.scroll_to_editor()})},attach:function(){var t,a,e,n,d,b,s,c,i,h,r;this.files&&1===this.files.length&&(t=o(this).closest(".bbpc-attachments-input"),b=d=n=e=!(a=""),r="",s=this.files[0],c=Math.round(s.size/1024),i=wp.bbpc.helper.file_extension(s.name),h=s.name+s.size+s.lastModified+s.type,t.removeClass("bbpc-attachment-invalid").addClass("bbpc-attachment-added").data("id",wp.bbpc.attachments.inner),r="<div>"+bbpc_data.attachments.text.file_name+": <strong>"+s.name+"</strong></div>",r+="<div>"+bbpc_data.attachments.text.file_size+": <strong>"+c+" kb</strong>, ",r+=bbpc_data.attachments.text.file_type+": <strong>"+i.toUpperCase()+"</strong></div>",-1<o.inArray(i,["js","php"])&&(b=e=!1),o.each(wp.bbpc.attachments.files,function(t,a){if(a===h)return n=e=!1}),n&&(wp.bbpc.attachments.files[wp.bbpc.attachments.inner]=h),bbpc_data.attachments.limiter&&(s.size>bbpc_data.attachments.max_size&&(d=e=!1),0<wp.bbpc.attachments.extensions.length&&-1===o.inArray(i,wp.bbpc.attachments.extensions)&&(b=e=!1)),e||(r+="<strong>",r+=bbpc_data.attachments.text.file_validation,n||(r+=" "+bbpc_data.attachments.text.file_validation_duplicate),b||(r+=" "+bbpc_data.attachments.text.file_validation_type),d||(r+=" "+bbpc_data.attachments.text.file_validation_size),r+="</strong><br/>",t.addClass("bbpc-attachment-invalid")),e&&(bbpc_data.attachments.set_caption_file&&(r+="<div><label><input name='bbpc-attachment_caption[]' type='text' style='display: none' placeholder='"+bbpc_data.attachments.text.file_caption_placeholder+"' /><span class='bbpc-accessibility-show-for-sr'>"+bbpc_data.attachments.text.file_caption_placeholder+"</span></label><a data-file='"+s.name+"' class='bbp-att-caption' href='#'>"+bbpc_data.attachments.text.file_caption+"</a></div>"),bbpc_data.attachments.insert_into_content&&(r+="<div><a class='bbp-att-shortcode' href='#'>"+bbpc_data.attachments.text.file_shortcode+"</a></div>")),r+="<div><a class='bbp-att-remove' href='#'>"+bbpc_data.attachments.text.file_remove+"</a></div>",t.find(".bbpc-attachment-control").html(r),t.find(".bbpc-attachment-control .bbp-att-shortcode").data("file",s.name),t.find(".bbpc-attachment-preview .bbpc-attached-file").remove(),l.FileReader&&/^([a-zA-Z0-9\s_\\.\-:\+])+(.jpg|.jpeg|.gif|.png|.bmp)$/.test(s.name.toLowerCase())?((r=new FileReader).readAsDataURL(s),r.onloadend=function(){a='<img class="bbpc-attached-file" alt="'+s.name+'" src="'+this.result+'" />',t.find(".bbpc-attachment-preview").prepend(a)}):(a='<p class="bbpc-attached-file" title="'+s.name+'">.'+i.toUpperCase()+"</p>",t.find(".bbpc-attachment-preview").prepend(a)),wp.bbpc.attachments.inner++,wp.bbpc.attachments.add(".bbpc-attachments-form .bbpc-attachment-add-file"),wp.bbpc.attachments.enhanced.check_submit())},check_submit:function(){var t=!0;o(".bbpc-attachments-form .bbpc-attachments-input").each(function(){o(this).hasClass("bbpc-attachment-invalid")&&(t=!1)}),o(".bbpc-attachments-form").closest("form").find(".bbp-submit-wrapper button").attr("disabled",!t)},block:function(){var t='<div class="bbpc-attachments-input bbpc-validation-active">';return t+='<div role="button" class="bbpc-attachment-preview"><span aria-hidden="true">'+bbpc_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="bbpc-attachment[]" />',t+='<span class="bbpc-accessibility-show-for-sr">'+bbpc_data.attachments.text.select_file+"</span></label>",t+='<div class="bbpc-attachment-control"></div>',t+="</div>"}},basic:{run:function(){},actions:function(){},block:function(){var t='<div class="bbpc-attachments-input bbpc-validation-disabled">';return t+='<div class="bbpc-attachment-header"><span aria-hidden="true">'+bbpc_data.attachments.text.select_file+"</span></div>",t+='<label><input type="file" size="40" name="bbpc-attachment[]" />',t+='<span class="bbpc-accessibility-show-for-sr">'+bbpc_data.attachments.text.select_file+"</span></label>",t+="</div>"}},thread:{nonce:"",topic:0,current:1,run:function(){o(t).on("click",".bbpc-attachments-thread-pager .__prev",function(t){t.preventDefault();t=o(this).closest(".bbp-form");1<wp.bbpc.attachments.thread.current&&(wp.bbpc.attachments.thread.current--,wp.bbpc.attachments.thread.show(t))}),o(t).on("click",".bbpc-attachments-thread-pager .__next",function(t){t.preventDefault();var a=o(this).closest(".bbp-form"),t=o(".bbpc-attachments-thread-pages",a).data("pages");wp.bbpc.attachments.thread.current<t&&(wp.bbpc.attachments.thread.current++,wp.bbpc.attachments.thread.show(a))}),o(t).on("click",".bbpc-attachments-thread-control a",function(t){t.preventDefault();t=o(this).parent().parent().find(".bbp-form");wp.bbpc.attachments.thread.nonce=o(this).data("nonce"),wp.bbpc.attachments.thread.topic=o(this).data("topic"),o(this).parent().remove(),t.show(),wp.bbpc.attachments.thread.fetch(t,1)})},show:function(t){var a=o(".bbpc-attachments-thread-pages",t),e=o(".bbpc-attachments-thread-pager",t),n=a.data("pages"),d=wp.bbpc.attachments.thread.current,a=o(".bbpc-attachments-thread-page-"+wp.bbpc.attachments.thread.current,t);e.removeClass("bbpc-thread-current-first").removeClass("bbpc-thread-current-last"),1===d?e.addClass("bbpc-thread-current-first"):d===n&&e.addClass("bbpc-thread-current-last"),o(".__current",e).html(d),a.hasClass("bbpc-attachments-thread-empty")?wp.bbpc.attachments.thread.fetch(t,d):(o(".bbpc-attachments-thread-page",t).hide(),o(".bbpc-attachments-thread-page-"+d,t).show())},fetch:function(a,e){o.ajax({dataType:"html",type:"post",data:{nonce:wp.bbpc.attachments.thread.nonce,topic:wp.bbpc.attachments.thread.topic,page:e},url:bbpc_data.url+"?action=bbpc_attachments_thread",success:function(t){o(".bbpc-attachments-thread-page",a).hide(),o(".bbpc-attachments-thread-page-"+e,a).html(t).removeClass("bbpc-attachments-thread-empty").show(),o(".bbpc-attachments-thread-pager",a).show()}})}}},o(t).ready(function(){wp.bbpc.attachments.init()})}(jQuery,window,document);