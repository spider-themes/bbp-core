!function(d,n,o){n.wp=n.wp||{},n.wp.gdbbx=n.wp.gdbbx||{},n.wp.gdbbx.helper={detect_msie:function(){var t=n.navigator.userAgent,e=t.indexOf("MSIE ");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<t.indexOf("Trident/")){e=t.indexOf("rv:");return parseInt(t.substring(e+3,t.indexOf(".",e)),10)}return 99},get_selection:function(){var t="";return n.getSelection?t=n.getSelection():o.getSelection?t=o.getSelection():o.selection&&(t=o.selection.createRange().text),d.trim(t.toString())},file_extension:function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},is_tinymce:function(){var t=0<d("#bbp_topic_content").length?"bbp_topic_content":"bbp_reply_content";return gdbbx_data.wp_editor&&!d("#"+t).is(":visible")},into_editor:function(t){var e,n=0<d("#bbp_topic_content").length?"bbp_topic_content":"bbp_reply_content";wp.gdbbx.helper.is_tinymce()?(t+="<br/><br/>",tinymce.get(n).execCommand("mceInsertContent",!1,t)):(n=(e=d("#"+n)).val(),""!==d.trim(n)&&(t="\n\n"+t),e.val(n+(t+="\n\n")))},scroll_to_editor:function(){8<wp.gdbbx.helper.detect_msie()?d("html, body").animate({scrollTop:d("#new-post").offset().top},1e3):o.location.href="#new-post",d(".bbp-the-content-wrapper textarea").focus()}},n.wp.gdbbx.toolbox={bbcodes:{init:function(){d(".gdbbx-bbcode-spoiler").each(function(){var t=d(this).data("hover"),e=d(this).data("color");d(this).hover(function(){d(this).css("background",t)},function(){d(this).css("background",e)})})}},quotes:{init:function(){d(o).on("click",".gdbbx-link-quote",function(t){var e,n,o,b;t.preventDefault(),0<d("#bbp_reply_content").length&&(o=wp.gdbbx.helper.get_selection(),e=d(this).data("id"),n=wp.gdbbx.helper.is_tinymce()?"</br></br>":"\n",t=!0,""===o&&(t=!1,o=d("#gdbbx-quote-wrapper-"+e).html()),o=(o=(o=(o=o.replace(/&nbsp;/g," ")).replace(/<\s*p[^>]*>/g,"")).replace(/<\s*\/\s*(p|br)\s*>|<\s*br\s*>/g,n)).trim(),o=d("<div>").html(o).html(),o="bbcode"===gdbbx_data.quote.method?"postquote"==(b="postquote"!==gdbbx_data.quote.bbcode||t?"quote":"postquote")?"["+b+" quote="+e+"]":"["+b+" quote="+e+"]"+o+"[/"+b+"]":(b=gdbbx_data.quote.wrote.replace("%s",d(this).data("author")),'<blockquote class="gdbbx-bbcode-quote">'+('<div class="gdbbx-quote-title"><a href="'+d(this).data("url")+'">'+b+":</a></div>")+o+"</blockquote>"),wp.gdbbx.helper.into_editor(o),wp.gdbbx.helper.scroll_to_editor())})}},canned_replies:{init:function(){d(".gdbbx-canned-replies .gdbbx-canned-replies-show").click(function(t){t.preventDefault();t=d(this).closest(".gdbbx-canned-replies");d(this).hide(),d(".gdbbx-canned-replies-hide",t).show(),d(".gdbbx-canned-replies-list",t).slideDown()}),d(".gdbbx-canned-replies .gdbbx-canned-replies-hide").click(function(t){t.preventDefault();t=d(this).closest(".gdbbx-canned-replies");d(this).hide(),d(".gdbbx-canned-replies-show",t).show(),d(".gdbbx-canned-replies-list",t).slideUp()}),d(".gdbbx-canned-replies .gdbbx-canned-reply-insert").click(function(t){t.preventDefault();var t=d(this).closest(".gdbbx-canned-reply"),t=d(".gdbbx-canned-reply-content",t).html();wp.gdbbx.helper.into_editor(t),gdbbx_data.canned_replies.auto_close_on_insert&&(t=d(this).closest(".gdbbx-canned-replies"),d(".gdbbx-canned-replies-hide",t).click())})}},fitvids:{init:function(){d(".bbp-topic-content, .bbp-reply-content").fitVids()}},report:{sending_report:!1,init:function(){d(".gdbbx-link-report").click(function(t){t.preventDefault(),wp.gdbbx.toolbox.report.sending_report||("form"===gdbbx_data.report.mode?wp.gdbbx.toolbox.report.form(d(this)):wp.gdbbx.toolbox.report.button(d(this)))})},button:function(t){var e,n=t.data("id"),t=t.data("nonce");"confirm"===gdbbx_data.report.mode&&!1===confirm(gdbbx_data.report.confirm)||(e={post:n,nonce:t},wp.gdbbx.toolbox.report.sending_report=!0,d.ajax({dataType:"html",type:"post",data:e,url:gdbbx_data.url+"?action=gdbbx_report_post",success:function(t){wp.gdbbx.toolbox.report.sending_report=!1,d(".gdbbx-link-report-"+e.post).replaceWith("<span>"+gdbbx_data.report.after+"</span>")}}))},form:function(t){var e,n=t.data("id"),o=t.data("nonce"),t=t.closest("#bbpress-forums").find(".post-"+n+" .bbp-reply-content, .post-"+n+" .bbp-topic-content");1===t.length&&(0===t.find(".gdbbx-report-wrapper").length&&(d(".gdbbx-report-wrapper").remove(),(e=d(".gdbbx-report-template > div").clone().addClass("gdbbx-report-wrapper")).find("button").data("id",n).data("nonce",o),t.append(e),e.find("input").focus(),wp.gdbbx.toolbox.report.handle(t.find(".gdbbx-report-wrapper"))),gdbbx_data.report.scroll&&((e=0)<d("#wpadminbar").length&&(e=d("#wpadminbar").height()),d("html, body").animate({scrollTop:t.find(".gdbbx-report-wrapper").offset().top-e},500)))},handle:function(n){d("button.gdbbx-report-cancel",n).click(function(){d(".gdbbx-report-wrapper").remove()}),d("button.gdbbx-report-send",n).click(function(){var e,t=d("input",n).val();t.length<gdbbx_data.report.min?alert(gdbbx_data.report.alert):(e={report:t,post:d(this).data("id"),nonce:d(this).data("nonce")},d(".gdbbx-report-form",n).hide(),d(".gdbbx-report-sending",n).show(),wp.gdbbx.toolbox.report.sending_report=!0,d.ajax({dataType:"html",type:"post",data:e,url:gdbbx_data.url+"?action=gdbbx_report_post",success:function(t){wp.gdbbx.toolbox.report.sending_report=!1,d(".gdbbx-report-sending",n).hide(),d(".gdbbx-report-sent",n).show(),d(".gdbbx-link-report-"+e.post).replaceWith("<span>"+gdbbx_data.report.after+"</span>")}}))})}},thanks:{init:function(){d(".gdbbx-link-thanks, .gdbbx-link-unthanks").click(function(t){t.preventDefault(),wp.gdbbx.toolbox.thanks.handle(this)})},handle:function(t){var e={nonce:d(t).data("thanks-nonce"),say:d(t).data("thanks-action"),id:d(t).data("thanks-id")},n=d(t),o=n.hasClass("gdbbx-link-thanks");d.ajax({dataType:"html",type:"post",data:e,url:gdbbx_data.url+"?action=gdbbx_say_thanks",success:function(t){t=d(t).fadeIn(600);d(".gdbbx-thanks-post-"+e.id).fadeOut(400).replaceWith(t),o?gdbbx_data.thanks.removal?n.removeClass("gdbbx-link-thanks").addClass("gdbbx-link-unthanks").data("thanks-action","unthanks").html(gdbbx_data.thanks.unthanks):n.replaceWith("<span>"+gdbbx_data.thanks.saved+"</span>"):n.removeClass("gdbbx-link-unthanks").addClass("gdbbx-link-thanks").data("thanks-action","thanks").html(gdbbx_data.thanks.thanks)}})}},scheduler:{init:function(){var t,e=d("#gdbbx_schedule_datetime");1===e.length&&(t=e.val(),t={enableTime:!0,enableSeconds:!0,altInput:!0,minDate:Date.now(),minTime:Date.now(),defaultDate:0===t.length?Date.now():t,dateFormat:"Y-m-d H:i:S"},""!==gdbbx_data.flatpickr_locale&&(t.locale=gdbbx_data.flatpickr_locale),e.flatpickr(t),d(o).on("change","#gdbbx_schedule_when",function(){var t=d(this).val(),e=d(this).parent().parent().next();"future"===t?e.show():e.hide()}))}},misc:{privacy:function(){d(".gdbbx-private-reply-hidden").each(function(){d(this).hide().prev(".bbp-reply-header").hide()})}},run:function(){"undefined"!=typeof gdbbx_data&&(wp.gdbbx.toolbox.misc.privacy(),-1<gdbbx_data.load.indexOf("scheduler")&&wp.gdbbx.toolbox.scheduler.init(),-1<gdbbx_data.load.indexOf("quote")&&wp.gdbbx.toolbox.quotes.init(),-1<gdbbx_data.load.indexOf("bbcodes")&&wp.gdbbx.toolbox.bbcodes.init(),-1<gdbbx_data.load.indexOf("report")&&wp.gdbbx.toolbox.report.init(),-1<gdbbx_data.load.indexOf("thanks")&&wp.gdbbx.toolbox.thanks.init(),-1<gdbbx_data.load.indexOf("canned_replies")&&wp.gdbbx.toolbox.canned_replies.init(),-1<gdbbx_data.load.indexOf("fitvids")&&d.fn.fitVids&&wp.gdbbx.toolbox.fitvids.init())}},d(o).ready(function(){wp.gdbbx.toolbox.run(),"object"==typeof EnlighterJS&&EnlighterJS.init("pre.gdbbx-bbcode-scode")})}(jQuery,window,document);